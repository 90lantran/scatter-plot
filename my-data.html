<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<script src="../jquery/dist/jquery.js"></script>
<script src="../iron-meta/iron-meta.html"></script>

<dom-module id="my-data">

<template>
	
	<style>
	:host{
		display: inline-block;
	}
	</style>

	<!-- <span>data from - {{dataUrl}}</span><br/>
	<span>data response length - {{dataResponse.length}}</span></br>
	<span>data - {{dataResponse}}</span> -->
<!-- 	<iron-ajax
		auto
		url={{dataUrl}}
		handle-as="json"
		last-response="{{response}}"
		on-response="handleResponse"
	></iron-ajax> -->

	<span> data is fetched from {{dataUrl}} </span></br>
	<span> data length is {{dataResponse.length}}</span></br>
	<span>data is {{dataResponse}}</span>

	<!-- <iron-meta id="one" key="x" value="[[dataResponse]]"></iron-meta> -->
	<div> Data from data source is {{dataResponse}}</div>
</template>

<script>

Polymer({
	is:'my-data',
	properties:{
		dataResponse:{
			// value:{{response}},
			type: Array,
			notify: true,
          readOnly: true,
          observer: '_dataResponseupdate'
		},
		dataUrl:{
			type: String,
			notify: true
		},
		datasourceId: {
			type: String,
			notify: true
		}
	},

	ready: function(){
		var self = this;
		$.get(this.dataUrl, function(json) {
			console.log(json);
		 	//self._setDataResponse(json);
		 	self._setDataResponse(json);
		 });
		
	},

	_dataResponseupdate: function(newVal, oldVal) {

		console.log("response Value Changed");
		//console.log(this.$.one.byKey("x"));
		//console.log(Polymer.dom(this).parentNode);

		var newElem = document.createElement('iron-meta');
		newElem.key = this.datasourceId;
		newElem.value = this.dataResponse;

		 Polymer.dom(this).parentNode.appendChild(newElem);
		 Polymer.dom.flush();


		 if(this.datasourceId == "ds2") {
		 	Polymer.dom(this).parentNode.querySelector('#plot1')._dataCreated();
		 }

		//var part = Polymer.dom(this).parentNode;

		// console.log(part);
		//var elem = part.querySelector('#id1');
		// console.log(elem);
		//elem.value = this.dataResponse;

		//$(Polymer.dom(this).parentNode).find('#plot1').attr('data', this.dataResponse);
	}

	//handleResponse: function(e,detail) {
		//var self = this;
		//console.log(self);
        //self._setDataResponses(detail.xhr.response); 
        // console.log(e);
        // this.isBusy = false;
        // this.fire("handle-response", detail.xhr.response);
    //}
	
});

</script>

</dom-module>